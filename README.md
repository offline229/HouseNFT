# ZJU-blockchain-course-2024-3220103468


## 如何运行

补充如何完整运行你的应用。

1. 在本地启动ganache应用，在8545端口，并在metamask导入需要用的账户的私钥，默认第一个用户为管理员。

2. 在 `./contracts` 中安装需要的依赖，运行如下的命令：
    ```bash
    npm install
    ```
3. 在 `./contracts` 中编译合约，运行如下的命令：
    ```bash
    npx hardhat compile
    ```
4. 在 `./contracts` 中部署合约，运行如下的命令：
    ```bash
    npx hardhat run ./scripts/deploy.ts --network ganache
    ```
    得到的地址后续用于连接网页。

5. 在`contracts/hardhat.config.ts`里加入ganache内的账号，在`deploy.ts`内连接区块链，默认端口localhost:8545，若无必要，可不更改。在`house-nft/src/contracts/contract-addresses.json`内填入刚刚部署合约时记录的地址.
   
6. 在 `./house-nft` 中安装需要的依赖，运行如下的命令：
    ```bash
    npm install
    ```
7. 在 `./house-nft` 中启动前端程序，运行如下的命令：
    ```bash
    npm run start
    ```

## 功能实现分析

简单描述：项目完成了要求的哪些功能？每个功能具体是如何实现的？

### 1. 创建房屋 NFT 集合
   - **功能描述**：在智能合约中发行房屋集合，基于 ERC721 标准，确保每个 NFT 独立代表一栋房屋。
   - **实现方法**：创建 ERC721 合约 `HouseNFT`，定义每个房屋为一个独立的 token，拥有独特的 `tokenId` 代表其身份。合约中定义了`mintHouse` 函数用于房屋的铸造发行，只有管理员可以进行铸造。

### 2. 领取房屋 NFT
   - **功能描述**：允许部分用户免费领取房屋 NFT，以便后续功能测试。
   - **实现方法**：合约中设置了管理员权限，仅限管理员调用 `mintHouse` 函数来铸造房屋 NFT，并将 NFT 分配给指定的用户。

### 3. 查看个人房产列表
   - **功能描述**：用户可以查看自己拥有的房屋 NFT。
   - **实现方法**：前端使用 `getHousesByOwner` 函数查询用户的房产列表，并展示每个房屋的 `tokenId` 和其他相关信息，见界面最下方。

### 4. 挂单出售房屋
   - **功能描述**：用户可以选择出售自己拥有的房屋 NFT，设定挂单价格。
   - **实现方法**：合约中添加了 `listHouse` 函数，用户提供房屋的 `tokenId` 和价格后，可以将房屋挂单出售。挂单时合约会保存挂单信息，包括房屋 ID、挂单价格、卖家地址等，并将房屋转入合约托管。

### 5. 查看所有挂单房产信息
   - **功能描述**：用户可以查看当前平台上所有出售中的房屋，以及房屋的价格、卖家和其他相关信息。
   - **实现方法**：前端使用 `getAllListings` 函数，查询并显示所有挂单房屋信息，包括每个房屋的 `tokenId`、挂单价格、房产的主人地址等。

### 6. 购买房屋 NFT
   - **功能描述**：用户可以使用测试以太币购买其他用户出售的房屋。购买成功后，房屋的所有权应变更为购买者。
   - **实现方法**：合约中的 `buyHouse` 函数允许用户输入 `tokenId` 和挂单价格以完成购买。购买成功后，合约将房屋 NFT 转移给购买者，交易记录更新，并调用 `_transfer` 方法完成 NFT 的所有权变更。

### 7. 撤销挂单
   - **功能描述**：用户可以撤销自己的挂单。
   - **实现方法**：通过调用`delistHouse` 函数，撤销已有的挂单，页面自动读取对应的`tokenId`作为参数并传入该函数，取消对应的挂单。

### 8. 收取平台手续费
   - **功能描述**：平台在每次房产交易完成时收取一定比例的手续费，并将其转入平台管理员账户。
   - **实现方法**：合约设置了手续费机制，基于房屋的挂单时间戳和成交价格，按固定比例计算手续费。交易完成后，`buyHouse` 函数自动计算并转移手续费给合约部署者。


---

## 其他细节

- **交易确认和页面刷新**：每次交易操作（如挂单、购买）后，前端会自动刷新，以确保用户看到最新数据。
- **权限控制**：合约部署者设为管理员，后台拥有部分管理权限，包括手续费收取账户的变更等。
- **测试网络配置**：用户需在 Metamask 上连接到 Ganache 测试网络，导入 Ganache 提供的测试账户私钥，以便进行交互和支付测试以太币。
- **错误提示**：多数操作在不满足要求，例如ETH不足，权限不足，不可重复挂单的时候，都会在控制台输出对应的操作提示，以便了解操作错误原因。

## 项目运行截图

放一些项目运行截图。

项目运行成功的关键页面和流程截图。主要包括操作流程以及和区块链交互的截图。

## 参考内容

- 课程的参考Demo见：[DEMOs](https://github.com/LBruyne/blockchain-course-demos)。
